<controls:BaseWindow x:Class="Tracker.Views.Dialogs.SetupWizard"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:Tracker.Controls"
        mc:Ignorable="d"
        Title="Tracker Setup"
        Height="550"
        Width="700"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize">

    <Border Background="{DynamicResource BackgroundBrush}"
            BorderBrush="{DynamicResource AccentBrush}"
            BorderThickness="2"
            CornerRadius="16">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" 
                    Background="{DynamicResource AccentBrush}"
                    CornerRadius="14,14,0,0"
                    Padding="24,20">
                <StackPanel>
                    <TextBlock Text="Welcome to Tracker"
                               FontSize="28"
                               FontWeight="Bold"
                               Foreground="{DynamicResource BackgroundBrush}"/>
                    <TextBlock Text="Let's set up your database connection"
                               FontSize="14"
                               Foreground="{DynamicResource BackgroundBrush}"
                               Opacity="0.8"
                               Margin="0,4,0,0"/>
                </StackPanel>
            </Border>

            <!-- Content Area -->
            <Grid Grid.Row="1" Margin="32,24">
                
                <!-- Step 1: Choose Database Type -->
                <StackPanel Visibility="{Binding IsStep1, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="How would you like to store your data?"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource ForegroundBrush}"
                               Margin="0,0,0,24"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="24"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Local Option -->
                        <Border Grid.Column="0"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{Binding IsLocalSelected, Converter={StaticResource BoolToAccentBorderConverter}}"
                                BorderThickness="2"
                                CornerRadius="12"
                                Padding="20"
                                Cursor="Hand">
                            <Border.InputBindings>
                                <MouseBinding MouseAction="LeftClick" Command="{Binding SelectLocalCommand}"/>
                            </Border.InputBindings>
                            <StackPanel>
                                <TextBlock Text="ðŸ“" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                                <TextBlock Text="Local Database"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           HorizontalAlignment="Center"/>
                                <TextBlock Text="Data stored on this PC"
                                           FontSize="12"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Opacity="0.7"
                                           HorizontalAlignment="Center"
                                           Margin="0,8,0,16"/>
                                <TextBlock Text="â€¢ No server required"
                                           FontSize="12"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Opacity="0.7"/>
                                <TextBlock Text="â€¢ Works offline"
                                           FontSize="12"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Opacity="0.7"/>
                                <TextBlock Text="â€¢ Best for single user"
                                           FontSize="12"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Opacity="0.7"/>
                            </StackPanel>
                        </Border>

                        <!-- SQL Server Option -->
                        <Border Grid.Column="2"
                                Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{Binding IsSqlServerSelected, Converter={StaticResource BoolToAccentBorderConverter}}"
                                BorderThickness="2"
                                CornerRadius="12"
                                Padding="20"
                                Cursor="Hand">
                            <Border.InputBindings>
                                <MouseBinding MouseAction="LeftClick" Command="{Binding SelectSqlServerCommand}"/>
                            </Border.InputBindings>
                            <StackPanel>
                                <TextBlock Text="ðŸŒ" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                                <TextBlock Text="SQL Server"
                                           FontSize="18"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           HorizontalAlignment="Center"/>
                                <TextBlock Text="Connect to a shared server"
                                           FontSize="12"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Opacity="0.7"
                                           HorizontalAlignment="Center"
                                           Margin="0,8,0,16"/>
                                <TextBlock Text="â€¢ Shared across team"
                                           FontSize="12"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Opacity="0.7"/>
                                <TextBlock Text="â€¢ Centralized data"
                                           FontSize="12"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Opacity="0.7"/>
                                <TextBlock Text="â€¢ Best for organizations"
                                           FontSize="12"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Opacity="0.7"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </StackPanel>

                <!-- Step 2: SQL Server Configuration -->
                <StackPanel Visibility="{Binding IsStep2, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="Configure SQL Server Connection"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource ForegroundBrush}"
                               Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="140"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Connection Type -->
                        <TextBlock Grid.Row="0" Text="Connection Type:"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,0,12"/>
                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,12">
                            <RadioButton Content="Direct" 
                                         IsChecked="{Binding ShowDirectConnection}"
                                         Foreground="{DynamicResource ForegroundBrush}"
                                         Margin="0,0,20,0"/>
                            <RadioButton Content="ODBC DSN" 
                                         IsChecked="{Binding UseOdbc}"
                                         Foreground="{DynamicResource ForegroundBrush}"/>
                        </StackPanel>

                        <!-- Direct Connection Fields -->
                        <TextBlock Grid.Row="1" Text="Server:"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,0,8"
                                   Visibility="{Binding ShowDirectConnection, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <TextBox Grid.Row="1" Grid.Column="1"
                                 Text="{Binding Server, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,0,8"
                                 Padding="8,6"
                                 Visibility="{Binding ShowDirectConnection, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <TextBlock Grid.Row="2" Text="Database:"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,0,8"
                                   Visibility="{Binding ShowDirectConnection, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <TextBox Grid.Row="2" Grid.Column="1"
                                 Text="{Binding Database, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,0,8"
                                 Padding="8,6"
                                 Visibility="{Binding ShowDirectConnection, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <!-- ODBC Field -->
                        <TextBlock Grid.Row="1" Text="ODBC DSN:"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,0,8"
                                   Visibility="{Binding UseOdbc, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <TextBox Grid.Row="1" Grid.Column="1"
                                 Text="{Binding OdbcDsn, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,0,8"
                                 Padding="8,6"
                                 Visibility="{Binding UseOdbc, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <!-- Authentication -->
                        <TextBlock Grid.Row="3" Text="Authentication:"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,0,8"
                                   Visibility="{Binding ShowDirectConnection, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <StackPanel Grid.Row="3" Grid.Column="1" Margin="0,0,0,8"
                                    Visibility="{Binding ShowDirectConnection, Converter={StaticResource BoolToVisibilityConverter}}">
                            <RadioButton Content="Windows Authentication" 
                                         IsChecked="{Binding UseWindowsAuth}"
                                         Foreground="{DynamicResource ForegroundBrush}"
                                         Margin="0,0,0,4"/>
                            <RadioButton Content="SQL Server Authentication" 
                                         IsChecked="{Binding UseWindowsAuth, Converter={StaticResource ReverseBooleanConverter}}"
                                         Foreground="{DynamicResource ForegroundBrush}"/>
                        </StackPanel>

                        <!-- SQL Credentials -->
                        <TextBlock Grid.Row="4" Text="Username:"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,0,8"
                                   Visibility="{Binding ShowCredentials, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <TextBox Grid.Row="4" Grid.Column="1"
                                 Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                                 Margin="0,0,0,8"
                                 Padding="8,6"
                                 Visibility="{Binding ShowCredentials, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <TextBlock Grid.Row="5" Text="Password:"
                                   Foreground="{DynamicResource ForegroundBrush}"
                                   VerticalAlignment="Center"
                                   Margin="0,0,0,8"
                                   Visibility="{Binding ShowCredentials, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <PasswordBox Grid.Row="5" Grid.Column="1"
                                     Margin="0,0,0,8"
                                     Padding="8,6"
                                     Visibility="{Binding ShowCredentials, Converter={StaticResource BoolToVisibilityConverter}}"/>

                        <!-- Test Connection -->
                        <StackPanel Grid.Row="6" Grid.Column="1" Orientation="Horizontal" Margin="0,12,0,0">
                            <Button Content="Test Connection"
                                    Command="{Binding TestConnectionCommand}"
                                    Padding="16,8"
                                    IsEnabled="{Binding IsTestingConnection, Converter={StaticResource ReverseBooleanConverter}}"/>
                            <TextBlock Text="{Binding ConnectionStatus}"
                                       Foreground="{DynamicResource ForegroundBrush}"
                                       VerticalAlignment="Center"
                                       Margin="16,0,0,0"
                                       TextWrapping="Wrap"
                                       MaxWidth="300"/>
                        </StackPanel>
                    </Grid>

                    <!-- Trust Certificate Option -->
                    <CheckBox Content="Trust server certificate (for self-signed certs)"
                              IsChecked="{Binding TrustServerCertificate}"
                              Foreground="{DynamicResource ForegroundBrush}"
                              Margin="0,20,0,0"
                              Visibility="{Binding ShowDirectConnection, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>

                <!-- Step 3: Summary -->
                <StackPanel Visibility="{Binding IsStep3, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="Ready to Set Up"
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource ForegroundBrush}"
                               Margin="0,0,0,20"/>

                    <Border Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="8"
                            Padding="20">
                        <StackPanel>
                            <TextBlock FontSize="14" Foreground="{DynamicResource ForegroundBrush}">
                                <Run Text="Database Type: " FontWeight="SemiBold"/>
                                <Run Text="{Binding SelectedDatabaseType}"/>
                            </TextBlock>

                            <!-- Local Summary -->
                            <StackPanel Visibility="{Binding IsLocalSelected, Converter={StaticResource BoolToVisibilityConverter}}"
                                        Margin="0,12,0,0">
                                <TextBlock FontSize="14" Foreground="{DynamicResource ForegroundBrush}">
                                    <Run Text="Location: " FontWeight="SemiBold"/>
                                    <Run Text="%LocalAppData%\Tracker\tracker.db"/>
                                </TextBlock>
                                <TextBlock Text="A local SQLite database will be created on your machine."
                                           FontSize="12"
                                           Foreground="{DynamicResource ForegroundBrush}"
                                           Opacity="0.7"
                                           Margin="0,8,0,0"
                                           TextWrapping="Wrap"/>
                            </StackPanel>

                            <!-- SQL Server Summary -->
                            <StackPanel Visibility="{Binding IsSqlServerSelected, Converter={StaticResource BoolToVisibilityConverter}}"
                                        Margin="0,12,0,0">
                                <TextBlock FontSize="14" Foreground="{DynamicResource ForegroundBrush}"
                                           Visibility="{Binding ShowDirectConnection, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Run Text="Server: " FontWeight="SemiBold"/>
                                    <Run Text="{Binding Server}"/>
                                </TextBlock>
                                <TextBlock FontSize="14" Foreground="{DynamicResource ForegroundBrush}"
                                           Visibility="{Binding ShowDirectConnection, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Run Text="Database: " FontWeight="SemiBold"/>
                                    <Run Text="{Binding Database}"/>
                                </TextBlock>
                                <TextBlock FontSize="14" Foreground="{DynamicResource ForegroundBrush}"
                                           Visibility="{Binding UseOdbc, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Run Text="ODBC DSN: " FontWeight="SemiBold"/>
                                    <Run Text="{Binding OdbcDsn}"/>
                                </TextBlock>
                                <TextBlock FontSize="14" Foreground="{DynamicResource ForegroundBrush}">
                                    <Run Text="Authentication: " FontWeight="SemiBold"/>
                                    <Run Text="{Binding UseWindowsAuth, Converter={StaticResource BoolToAuthTypeConverter}}"/>
                                </TextBlock>

                                <CheckBox Content="Create database and tables if they don't exist"
                                          IsChecked="{Binding CreateDatabase}"
                                          Foreground="{DynamicResource ForegroundBrush}"
                                          Margin="0,16,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <TextBlock Text="Click 'Finish' to complete setup and start using Tracker."
                               FontSize="12"
                               Foreground="{DynamicResource ForegroundBrush}"
                               Opacity="0.7"
                               Margin="0,20,0,0"/>
                </StackPanel>
            </Grid>

            <!-- Footer with Navigation -->
            <Border Grid.Row="2" 
                    Background="{DynamicResource SurfaceBrush}"
                    CornerRadius="0,0,14,14"
                    Padding="24,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Step Indicator -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Ellipse Width="10" Height="10" 
                                 Fill="{Binding IsStep1, Converter={StaticResource BoolToAccentFillConverter}}"/>
                        <Rectangle Width="30" Height="2" Fill="{DynamicResource AccentBrush}" Opacity="0.3" Margin="4,0"/>
                        <Ellipse Width="10" Height="10" 
                                 Fill="{Binding IsStep2, Converter={StaticResource BoolToAccentFillConverter}}"
                                 Visibility="{Binding IsSqlServerSelected, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <Rectangle Width="30" Height="2" Fill="{DynamicResource AccentBrush}" Opacity="0.3" Margin="4,0"
                                   Visibility="{Binding IsSqlServerSelected, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <Ellipse Width="10" Height="10" 
                                 Fill="{Binding IsStep3, Converter={StaticResource BoolToAccentFillConverter}}"/>
                    </StackPanel>

                    <!-- Navigation Buttons -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="Back"
                                Command="{Binding BackCommand}"
                                Padding="20,10"
                                Margin="0,0,8,0"
                                Visibility="{Binding IsStep1, Converter={StaticResource ReverseBoolToVisConverter}}"/>
                        <Button Content="Next"
                                Command="{Binding NextCommand}"
                                Padding="20,10"
                                Visibility="{Binding IsStep2, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <Button Content="Finish"
                                Command="{Binding FinishCommand}"
                                Padding="20,10"
                                Background="{DynamicResource AccentBrush}"
                                Foreground="{DynamicResource BackgroundBrush}"
                                Visibility="{Binding IsStep3, Converter={StaticResource BoolToVisibilityConverter}}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</controls:BaseWindow>

